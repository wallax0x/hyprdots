<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro - Garanhuns Serviços</title>
    
    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        body {
            background: #f5f7fa;
        }

        .card {
            border-radius: 14px;
            overflow: hidden;
        }

        .card-header {
            background: #0d6efd;
            border-bottom: none;
        }

        .form-control:focus {
            box-shadow: 0 0 0 0.15rem rgba(13,110,253,.25);
        }

        .password-strength {
            height: 5px;
            border-radius: 5px;
        }

        .hidden-input {
            display: none !important;
        }
    </style>
</head>
<body>

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="card shadow">
                
                <!-- HEADER -->
                <div class="card-header text-white text-center py-3">
                    <h4 class="fw-bold mb-0">Criar Conta</h4>
                </div>

                <div class="card-body p-4">

                    <!-- FLASH MESSAGES -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }} text-center">{{ message }}</div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <!-- FORM -->
                    <form method="POST" action="/cadastro" autocomplete="off" onsubmit="return validarTudo()">
                        
                        <!-- ANTI-AUTOFILL DO NAVEGADOR -->
                        <input type="text" class="hidden-input">
                        <input type="password" class="hidden-input">

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Nome Completo</label>
                            <input type="text" name="nome" class="form-control" required>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">CPF</label>
                                <input type="text" name="cpf" id="cpf" class="form-control" maxlength="14" placeholder="000.000.000-00">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">WhatsApp</label>
                                <input type="text" name="whatsapp" id="whatsapp" class="form-control" maxlength="15" placeholder="(87) 99999-9999">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Email</label>
                            <input type="email" name="email" class="form-control" autocomplete="new-email" required>
                        </div>

                        <!-- SENHAS -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">Senha</label>
                                <div class="input-group">
                                    <input type="password" name="senha" id="senha" class="form-control" autocomplete="new-password" required oninput="forcaSenha()">
                                    <button type="button" class="btn btn-outline-secondary" onclick="toggleSenha('senha')">
                                        <i class="bi bi-eye-slash"></i>
                                    </button>
                                </div>
                                <div class="password-strength mt-2" id="barraForca" style="background:#ddd"></div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">Confirmar Senha</label>
                                <div class="input-group">
                                    <input type="password" id="confirma_senha" class="form-control" autocomplete="new-password" required>
                                    <button type="button" class="btn btn-outline-secondary" onclick="toggleSenha('confirma_senha')">
                                        <i class="bi bi-eye-slash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="erro-senha" class="text-danger small mb-2" style="display:none;">As senhas não coincidem!</div>

                        <!-- TIPO DE CONTA -->
                        <div class="mb-3 p-3 bg-light rounded border">
                            <label class="form-label fw-bold">Você é:</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo" value="cliente" checked onclick="toggleProfissional(false)">
                                <label class="form-check-label">Cliente (Contratar)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo" value="profissional" onclick="toggleProfissional(true)">
                                <label class="form-check-label">Profissional (Trabalhar)</label>
                            </div>
                        </div>

                        <!-- ÁREA PROFISSIONAL -->
                        <div id="areaProfissional" style="display:none;">
                            <h6 class="mb-3 text-primary fw-bold">Informações do Profissional</h6>

                            <div class="mb-3">
                                <label class="form-label">Profissão</label>
                                <input type="text" name="profissao" class="form-control" placeholder="Ex: Eletricista, Pedreiro">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Bairro</label>
                                <select name="bairro" class="form-select">
                                    <option value="Heliópolis">Heliópolis</option>
                                    <option value="Magano">Magano</option>
                                    <option value="Boa Vista">Boa Vista</option>
                                    <option value="Centro">Centro</option>
                                    <option value="Cohab 1">Cohab 1</option>
                                    <option value="Cohab 2">Cohab 2</option>
                                    <option value="Aloísio Pinto">Aloísio Pinto</option>
                                    <option value="Brasília">Brasília</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Descrição</label>
                                <textarea name="descricao" class="form-control" rows="3" placeholder="Fale um pouco sobre você..."></textarea>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 fw-bold btn-lg shadow-sm mt-3">
                            Criar Conta
                        </button>

                    </form>

                    <div class="text-center mt-3">
                        <a href="/login" class="text-decoration-none">Já tem conta? Entrar</a>
                        |
                        <a href="/" class="text-decoration-none">Voltar</a>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>


<!-- JS -->
<script>
    function validarTudo() {
        return validarSenhas();
    }

    function validarSenhas() {
        let s = document.getElementById('senha').value;
        let c = document.getElementById('confirma_senha').value;
        let erro = document.getElementById('erro-senha');

        if (s !== c) {
            erro.style.display = 'block';
            return false;
        }
        erro.style.display = 'none';
        return true;
    }

    function toggleSenha(id) {
        let input = document.getElementById(id);
        input.type = input.type === 'password' ? 'text' : 'password';
    }

    function toggleProfissional(show) {
        document.getElementById('areaProfissional').style.display = show ? 'block' : 'none';
        document.querySelector('[name="profissao"]').required = show;
    }

    // Máscara CPF
    document.getElementById('cpf').addEventListener('input', function () {
        let v = this.value.replace(/\D/g, "");
        if (v.length <= 11) {
            v = v.replace(/(\d{3})(\d)/, "$1.$2");
            v = v.replace(/(\d{3})(\d)/, "$1.$2");
            v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
        }
        this.value = v;
    });

    // Máscara Telefone
    document.getElementById('whatsapp').addEventListener('input', function () {
        let v = this.value.replace(/\D/g, "");
        v = v.replace(/^(\d{2})(\d)/g, "($1) $2");
        v = v.replace(/(\d)(\d{4})$/, "$1-$2");
        this.value = v;
    });

    // Força de senha
    function forcaSenha() {
        let senha = document.getElementById('senha').value;
        let barra = document.getElementById('barraForca');

        let forca = 0;
        if (senha.length >= 6) forca++;
        if (/[A-Z]/.test(senha)) forca++;
        if (/[0-9]/.test(senha)) forca++;
        if (/[@#$%&!?*]/.test(senha)) forca++;

        const cores = ["#ddd", "#dc3545", "#ffc107", "#20c997", "#198754"];
        barra.style.background = cores[forca];
    }
</script>

</body>
</html>
